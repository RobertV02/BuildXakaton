{% load static %}
<!DOCTYPE html>
<html lang="ru" class="h-full bg-gray-50">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>{% block title %}Alpha Build{% endblock %}</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script>
    tailwind.config = {
      theme: {
        extend: {
          colors: {
            primary: { 
              50: '#eff6ff', 100: '#dbeafe', 200: '#bfdbfe', 300: '#93c5fd', 400: '#60a5fa', 
              500: '#3b82f6', 600: '#2563eb', 700: '#1d4ed8', 800: '#1e40af', 900: '#1e3a8a' 
            },
            success: { 
              50: '#ecfdf5', 100: '#d1fae5', 200: '#a7f3d0', 300: '#6ee7b7', 400: '#34d399',
              500: '#10b981', 600: '#059669', 700: '#047857', 800: '#065f46', 900: '#064e3b' 
            },
            warning: { 
              50: '#fffbeb', 100: '#fef3c7', 200: '#fde68a', 300: '#fcd34d', 400: '#fbbf24',
              500: '#f59e0b', 600: '#d97706', 700: '#b45309', 800: '#92400e', 900: '#78350f' 
            },
            danger: { 
              50: '#fef2f2', 100: '#fee2e2', 200: '#fecaca', 300: '#fca5a5', 400: '#f87171',
              500: '#ef4444', 600: '#dc2626', 700: '#b91c1c', 800: '#991b1b', 900: '#7f1d1d' 
            },
            gray: {
              50: '#f9fafb', 100: '#f3f4f6', 200: '#e5e7eb', 300: '#d1d5db', 400: '#9ca3af',
              500: '#6b7280', 600: '#4b5563', 700: '#374151', 800: '#1f2937', 900: '#111827'
            }
          },
          animation: {
            'fade-in': 'fadeIn 0.5s ease-in-out',
            'slide-up': 'slideUp 0.6s ease-out',
            'slide-down': 'slideDown 0.4s ease-out',
            'scale-in': 'scaleIn 0.3s ease-out',
            'bounce-soft': 'bounceSoft 0.6s ease-out'
          },
          keyframes: {
            fadeIn: {
              '0%': { opacity: '0', transform: 'translateY(10px)' },
              '100%': { opacity: '1', transform: 'translateY(0)' }
            },
            slideUp: {
              '0%': { opacity: '0', transform: 'translateY(30px)' },
              '100%': { opacity: '1', transform: 'translateY(0)' }
            },
            slideDown: {
              '0%': { opacity: '0', transform: 'translateY(-20px)' },
              '100%': { opacity: '1', transform: 'translateY(0)' }
            },
            scaleIn: {
              '0%': { opacity: '0', transform: 'scale(0.95)' },
              '100%': { opacity: '1', transform: 'scale(1)' }
            },
            bounceSoft: {
              '0%': { transform: 'scale(0.95)' },
              '50%': { transform: 'scale(1.02)' },
              '100%': { transform: 'scale(1)' }
            }
          },
          backdropBlur: {
            xs: '2px'
          }
        }
      }
    }
  </script>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
  <style>
    body { 
      font-family: 'Inter', sans-serif; 
      background: linear-gradient(135deg, #f8fafc 0%, #f1f5f9 100%);
    }
    .mobile-menu { 
      transform: translateX(-100%); 
      transition: transform 0.4s cubic-bezier(0.4, 0, 0.2, 1);
      backdrop-filter: blur(10px);
    }
    .mobile-menu.open { transform: translateX(0); }
    
    .glass-effect {
      background: rgba(255, 255, 255, 0.9);
      backdrop-filter: blur(10px);
      border: 1px solid rgba(255, 255, 255, 0.2);
    }
    
    .nav-item {
      position: relative;
      overflow: hidden;
    }
    
    .nav-item::before {
      content: '';
      position: absolute;
      top: 0;
      left: -100%;
      width: 100%;
      height: 100%;
      background: linear-gradient(90deg, transparent, rgba(59, 130, 246, 0.1), transparent);
      transition: left 0.5s;
    }
    
    .nav-item:hover::before {
      left: 100%;
    }
    
    .card-hover {
      transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    }
    
    .card-hover:hover {
      transform: translateY(-2px);
      box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04);
    }
    
    .btn-primary {
      background: linear-gradient(135deg, #3b82f6 0%, #2563eb 100%);
      box-shadow: 0 4px 6px -1px rgba(59, 130, 246, 0.3);
      transition: all 0.3s ease;
    }
    
    .btn-primary:hover {
      background: linear-gradient(135deg, #2563eb 0%, #1d4ed8 100%);
      box-shadow: 0 10px 15px -3px rgba(59, 130, 246, 0.4);
      transform: translateY(-1px);
    }
    
    .sidebar-gradient {
      background: linear-gradient(180deg, #1e40af 0%, #1d4ed8 50%, #2563eb 100%);
    }
    
    @keyframes pulse-soft {
      0%, 100% { opacity: 1; }
      50% { opacity: 0.8; }
    }
    
    .animate-pulse-soft {
      animation: pulse-soft 2s cubic-bezier(0.4, 0, 0.6, 1) infinite;
    }
  </style>
  {% block extra_head %}{% endblock %}
</head>
<body class="h-full flex bg-gray-50">
  <!-- Mobile Sidebar Overlay -->
  <div id="mobile-overlay" class="fixed inset-0 bg-black bg-opacity-50 z-40 md:hidden hidden"></div>
  
  <!-- Sidebar -->
  <aside id="sidebar" class="mobile-menu md:translate-x-0 fixed md:relative z-50 md:z-auto w-64 sidebar-gradient min-h-screen md:flex md:flex-col shadow-2xl md:shadow-xl">
    <div class="h-16 flex items-center justify-between px-6 border-b border-blue-600/30 backdrop-blur-sm">
      <a href="/" class="text-xl font-bold text-white tracking-tight flex items-center gap-2">
        <div class="w-8 h-8 bg-white/20 rounded-lg flex items-center justify-center backdrop-blur-sm">
          <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
            <path d="M10.707 2.293a1 1 0 00-1.414 0l-7 7a1 1 0 001.414 1.414L4 10.414V17a1 1 0 001 1h2a1 1 0 001-1v-2a1 1 0 011-1h2a1 1 0 011 1v2a1 1 0 001 1h2a1 1 0 001-1v-6.586l.293.293a1 1 0 001.414-1.414l-7-7z"></path>
          </svg>
        </div>
        Alpha Build
      </a>
      <button id="closeSidebar" class="md:hidden text-white/80 hover:text-white p-2 rounded-lg hover:bg-white/10 transition-all duration-200">
        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
        </svg>
      </button>
    </div>
    
    <nav class="flex-1 overflow-y-auto py-6 px-3">
      {% with p=request.path %}
      <ul class="space-y-2">
        <li>
          <a href="/" class="nav-item group flex items-center gap-3 px-4 py-3 rounded-xl font-medium transition-all duration-300 {% if p == '/' %}bg-white/20 text-white shadow-lg backdrop-blur-sm{% else %}text-white/80 hover:bg-white/10 hover:text-white{% endif %}">
            <div class="w-5 h-5 flex items-center justify-center">
              <svg class="w-5 h-5 transition-transform duration-300 group-hover:scale-110" fill="currentColor" viewBox="0 0 20 20">
                <path d="M10.707 2.293a1 1 0 00-1.414 0l-7 7a1 1 0 001.414 1.414L4 10.414V17a1 1 0 001 1h2a1 1 0 001-1v-2a1 1 0 011-1h2a1 1 0 011 1v2a1 1 0 001 1h2a1 1 0 001-1v-6.586l.293.293a1 1 0 001.414-1.414l-7-7z"></path>
              </svg>
            </div>
            <span class="transition-all duration-300">Дашборд</span>
            {% if p == '/' %}
              <div class="ml-auto w-2 h-2 bg-white rounded-full animate-pulse-soft"></div>
            {% endif %}
          </a>
        </li>
        <li>
          <a href="/objects/" class="nav-item group flex items-center gap-3 px-4 py-3 rounded-xl font-medium transition-all duration-300 {% if p|slice:':9' == '/objects/' or p == '/objects/' %}bg-white/20 text-white shadow-lg backdrop-blur-sm{% else %}text-white/80 hover:bg-white/10 hover:text-white{% endif %}">
            <div class="w-5 h-5 flex items-center justify-center">
              <svg class="w-5 h-5 transition-transform duration-300 group-hover:scale-110" fill="currentColor" viewBox="0 0 20 20">
                <path fill-rule="evenodd" d="M4 4a2 2 0 00-2 2v8a2 2 0 002 2h12a2 2 0 002-2V6a2 2 0 00-2-2H4zm0 2h12v8H4V6z" clip-rule="evenodd"></path>
              </svg>
            </div>
            <span class="transition-all duration-300">Объекты</span>
            {% if p|slice:':9' == '/objects/' or p == '/objects/' %}
              <div class="ml-auto w-2 h-2 bg-white rounded-full animate-pulse-soft"></div>
            {% endif %}
          </a>
        </li>
        <li>
          <a href="/deliveries/" class="nav-item group flex items-center gap-3 px-4 py-3 rounded-xl font-medium transition-all duration-300 {% if p|slice:':12' == '/deliveries/' or p == '/deliveries/' %}bg-white/20 text-white shadow-lg backdrop-blur-sm{% else %}text-white/80 hover:bg-white/10 hover:text-white{% endif %}">
            <div class="w-5 h-5 flex items-center justify-center">
              <svg class="w-5 h-5 transition-transform duration-300 group-hover:scale-110" fill="currentColor" viewBox="0 0 20 20">
                <path d="M8 16.5a1.5 1.5 0 11-3 0 1.5 1.5 0 013 0zM15 16.5a1.5 1.5 0 11-3 0 1.5 1.5 0 013 0z"></path>
                <path d="M3 4a1 1 0 00-1 1v10a1 1 0 001 1h1.05a2.5 2.5 0 014.9 0H10a1 1 0 001-1V5a1 1 0 00-1-1H3zM14 7a1 1 0 00-1 1v6.05A2.5 2.5 0 0115.95 16H17a1 1 0 001-1V8a1 1 0 00-1-1h-3z"></path>
              </svg>
            </div>
            <span class="transition-all duration-300">Поставки</span>
            {% if p|slice:':12' == '/deliveries/' or p == '/deliveries/' %}
              <div class="ml-auto w-2 h-2 bg-white rounded-full animate-pulse-soft"></div>
            {% endif %}
          </a>
        </li>
        <li>
          <a href="/remarks/" class="nav-item group flex items-center gap-3 px-4 py-3 rounded-xl font-medium transition-all duration-300 {% if p|slice:':9' == '/remarks/' or p == '/remarks/' %}bg-white/20 text-white shadow-lg backdrop-blur-sm{% else %}text-white/80 hover:bg-white/10 hover:text-white{% endif %}">
            <div class="w-5 h-5 flex items-center justify-center">
              <svg class="w-5 h-5 transition-transform duration-300 group-hover:scale-110" fill="currentColor" viewBox="0 0 20 20">
                <path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z" clip-rule="evenodd"></path>
              </svg>
            </div>
            <span class="transition-all duration-300">Нарушения</span>
            {% if p|slice:':9' == '/remarks/' or p == '/remarks/' %}
              <div class="ml-auto w-2 h-2 bg-white rounded-full animate-pulse-soft"></div>
            {% endif %}
          </a>
        </li>
        <li>
          <a href="/checklists/" class="nav-item group flex items-center gap-3 px-4 py-3 rounded-xl font-medium transition-all duration-300 {% if p|slice:':12' == '/checklists/' or p == '/checklists/' %}bg-white/20 text-white shadow-lg backdrop-blur-sm{% else %}text-white/80 hover:bg-white/10 hover:text-white{% endif %}">
            <div class="w-5 h-5 flex items-center justify-center">
              <svg class="w-5 h-5 transition-transform duration-300 group-hover:scale-110" fill="currentColor" viewBox="0 0 20 20">
                <path fill-rule="evenodd" d="M3 4a1 1 0 011-1h12a1 1 0 011 1v2a1 1 0 01-1 1H4a1 1 0 01-1-1V4zm0 4a1 1 0 011-1h12a1 1 0 011 1v2a1 1 0 01-1 1H4a1 1 0 01-1-1V8zm0 4a1 1 0 011-1h12a1 1 0 011 1v2a1 1 0 01-1 1H4a1 1 0 01-1-1v-2z" clip-rule="evenodd"></path>
              </svg>
            </div>
            <span class="transition-all duration-300">Чек-листы</span>
            {% if p|slice:':12' == '/checklists/' or p == '/checklists/' %}
              <div class="ml-auto w-2 h-2 bg-white rounded-full animate-pulse-soft"></div>
            {% endif %}
          </a>
        </li>
      </ul>
      {% endwith %}
      
      {% if user.is_authenticated %}
      <div class="px-4 mt-6">
        <div class="glass-effect rounded-xl p-4 border border-white/20">
          <div class="flex items-center gap-3 mb-3">
            <div class="w-10 h-10 bg-gradient-to-br from-white/30 to-white/10 rounded-xl flex items-center justify-center backdrop-blur-sm border border-white/20">
              <span class="text-white text-sm font-semibold">{{ user.username|first|upper }}</span>
            </div>
            <div class="flex-1 min-w-0">
              <p class="text-sm font-medium text-white truncate">{{ user.username }}</p>
              <p class="text-xs text-white/60">{{ user.email|default:"Нет email" }}</p>
            </div>
          </div>
          <div class="space-y-2">
            <form method="post" action="{% url 'logout' %}">
              {% csrf_token %}
              <button class="flex items-center gap-2 px-3 py-2 text-sm text-white/80 hover:bg-red-500/20 hover:text-white rounded-lg transition-all duration-300 w-full text-left group" type="submit">
                <svg class="w-4 h-4 transition-transform duration-300 group-hover:scale-110" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 16l4-4m0 0l-4-4m4 4H7m6 4v1a3 3 0 01-3 3H6a3 3 0 01-3-3V7a3 3 0 013-3h4a3 3 0 013 3v1"></path>
                </svg>
                Выйти
              </button>
            </form>
          </div>
        </div>
      </div>
      {% endif %}
    </nav>
    
    <div class="p-4 border-t border-white/20">
      <div class="text-center text-xs text-white/60 font-medium">
        © 2025 Alpha Build
      </div>
    </div>
  </aside>

  <!-- Main Content -->
  <div class="lg:ml-64 min-h-screen bg-gradient-to-br from-blue-50 to-indigo-100">
    <!-- Header -->
    <header class="glass-effect border-b border-white/20 lg:border-b-0 lg:border-0">
      <div class="flex justify-between items-center px-4 py-4 lg:px-8 lg:py-6">
        <div class="flex items-center gap-4">
          <button id="mobile-menu-toggle" class="lg:hidden p-2 rounded-lg bg-blue-500 text-white hover:bg-blue-600 transition-colors">
            <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"></path>
            </svg>
          </button>
          <div>
            <h1 class="text-2xl font-bold text-gray-900 tracking-tight">
              {% block page_title %}{{ view.title|default:"Главная" }}{% endblock %}
            </h1>
            <p class="text-sm text-gray-600 mt-1">
              {% block subtitle %}Система управления строительством{% endblock %}
            </p>
          </div>
        </div>
        
        <div class="flex items-center gap-4">
          <!-- Search -->
          <div class="hidden md:block relative">
            <input type="search" placeholder="Поиск..." 
                   class="w-64 px-4 py-2 pl-10 bg-white/50 backdrop-blur-sm border border-white/30 rounded-xl text-gray-900 placeholder-gray-500 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all duration-300">
            <svg class="absolute left-3 top-2.5 w-5 h-5 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"></path>
            </svg>
          </div>
          
          <!-- Notifications -->
          <button class="relative p-2 bg-white/20 backdrop-blur-sm hover:bg-white/30 rounded-xl transition-all duration-300 group">
            <svg class="w-6 h-6 text-gray-700 group-hover:text-blue-600 transition-colors" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 17h5l-5 5v-5z"></path>
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 19H4a2 2 0 01-2-2V7a2 2 0 012-2h16a2 2 0 012 2v10a2 2 0 01-2 2h-5"></path>
            </svg>
            <span class="absolute -top-1 -right-1 w-4 h-4 bg-red-500 text-white text-xs rounded-full flex items-center justify-center animate-pulse">3</span>
          </button>

          <!-- Profile Dropdown -->
          <div class="relative group">
            <button class="flex items-center gap-2 p-2 bg-white/20 backdrop-blur-sm hover:bg-white/30 rounded-xl transition-all duration-300">
              <div class="w-8 h-8 bg-gradient-to-br from-blue-500 to-indigo-600 rounded-lg flex items-center justify-center">
                <span class="text-white text-sm font-semibold">{{ user.username|first|upper }}</span>
              </div>
              <svg class="w-4 h-4 text-gray-600 group-hover:text-blue-600 transition-colors" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path>
              </svg>
            </button>
          </div>
        </div>
      </div>
    </header>

    <!-- Toast notifications -->
    <div id="toast-container" class="fixed top-4 right-4 z-50 space-y-3 max-w-sm"></div>

    <!-- Page content -->
    <main class="flex-1 p-4 lg:p-8 bg-gray-50" id="content">
      {% if messages %}
        <div id="django-messages" class="hidden">
          {% for message in messages %}
            <div data-tags="{{ message.tags }}" data-text="{{ message|escape }}"></div>
          {% endfor %}
        </div>
      {% endif %}
      
      <div class="max-w-7xl mx-auto">
        {% block content %}{% endblock %}
      </div>
    </main>
  </div>

  {% block extra_scripts %}{% endblock %}
  <script>
    // Mobile menu functionality
    document.addEventListener('DOMContentLoaded', function() {
      const mobileToggle = document.getElementById('mobileMenuToggle');
      const sidebar = document.getElementById('sidebar');
      const overlay = document.getElementById('mobile-overlay');
      const closeSidebar = document.getElementById('closeSidebar');
      
      function openSidebar() {
        sidebar.classList.add('open');
        overlay.classList.remove('hidden');
        document.body.classList.add('overflow-hidden');
      }
      
      function closeSidebarFn() {
        sidebar.classList.remove('open');
        overlay.classList.add('hidden');
        document.body.classList.remove('overflow-hidden');
      }
      
      mobileToggle?.addEventListener('click', openSidebar);
      closeSidebar?.addEventListener('click', closeSidebarFn);
      overlay?.addEventListener('click', closeSidebarFn);
      
      // Enhanced toast notifications
      const container = document.getElementById('toast-container');
      const raw = document.getElementById('django-messages');
      
      if(raw) {
        [...raw.children].forEach((m, idx) => {
          const text = m.getAttribute('data-text');
          const tags = m.getAttribute('data-tags') || '';
          
          let bgColor, icon;
          if (tags.includes('error')) {
            bgColor = 'bg-danger-500';
            icon = '<svg class="w-5 h-5" fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7 4a1 1 0 11-2 0 1 1 0 012 0zm-1-9a1 1 0 00-1 1v4a1 1 0 102 0V6a1 1 0 00-1-1z" clip-rule="evenodd"></path></svg>';
          } else if (tags.includes('success')) {
            bgColor = 'bg-success-500';
            icon = '<svg class="w-5 h-5" fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd"></path></svg>';
          } else {
            bgColor = 'bg-gray-700';
            icon = '<svg class="w-5 h-5" fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a.75.75 0 000 1.5h.253a.25.25 0 01.244.304l-.459 2.066A1.75 1.75 0 0010.747 15H11a.75.75 0 000-1.5h-.253a.25.25 0 01-.244-.304l.459-2.066A1.75 1.75 0 009.253 9H9z" clip-rule="evenodd"></path></svg>';
          }
          
          const el = document.createElement('div');
          el.className = `${bgColor} text-white shadow-lg rounded-xl px-4 py-3 text-sm flex items-start gap-3 transform transition-all duration-300 slide-up max-w-sm`;
          el.innerHTML = `
            <div class="flex-shrink-0 mt-0.5">${icon}</div>
            <div class="flex-1 font-medium">${text}</div>
            <button class="flex-shrink-0 text-white/70 hover:text-white transition-colors ml-2">
              <svg class="w-4 h-4" fill="currentColor" viewBox="0 0 20 20">
                <path fill-rule="evenodd" d="M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z" clip-rule="evenodd"></path>
              </svg>
            </button>
          `;
          
          const closeBtn = el.querySelector('button');
          closeBtn.addEventListener('click', () => {
            el.style.transform = 'translateX(100%)';
            el.style.opacity = '0';
            setTimeout(() => el.remove(), 300);
          });
          
          setTimeout(() => {
            if(document.body.contains(el)) {
              el.style.transform = 'translateX(100%)';
              el.style.opacity = '0';
              setTimeout(() => el.remove(), 300);
            }
          }, 5000 + idx * 500);
          
          setTimeout(() => container.appendChild(el), idx * 100);
        });
      }
    });
  </script>
</body>
</html>
