{% extends 'base.html' %}
{% load object_extras %}
{% block title %}{{ object.name }} - Alpha Build{% endblock %}
{% block page_heading %}{{ object.name }}{% endblock %}
{% block page_subtitle %}Управление строительным объектом{% endblock %}

{% block content %}
<!-- Breadcrumb -->
<nav class="flex items-center gap-2 text-sm text-gray-500 mb-6">
  <a href="/objects/" class="hover:text-primary-600 transition-colors">Объекты</a>
  <svg class="w-4 h-4" fill="currentColor" viewBox="0 0 20 20">
    <path fill-rule="evenodd" d="M7.293 14.707a1 1 0 010-1.414L10.586 10 7.293 6.707a1 1 0 111.414-1.414l4 4a1 1 0 010 1.414l-4 4a1 1 0 01-1.414 0z" clip-rule="evenodd"></path>
  </svg>
  <span class="text-gray-900 font-medium">{{ object.name }}</span>
</nav>

<!-- Header Section -->
<div class="bg-white rounded-2xl shadow-sm border border-gray-100 p-6 mb-8">
  <div class="flex flex-col lg:flex-row lg:items-start lg:justify-between gap-6">
    <!-- Object Info -->
    <div class="flex-1">
      <div class="flex items-start gap-4">
        <div class="w-16 h-16 bg-gradient-to-br from-primary-500 to-primary-600 rounded-2xl flex items-center justify-center text-white font-bold text-xl">
          {{ object.name|first|upper }}
        </div>
        <div class="flex-1">
          <div class="flex items-center gap-3 mb-2">
            <h1 class="text-2xl font-bold text-gray-900">{{ object.name }}</h1>
            {% status_badge object.status %}
          </div>
          <p class="text-sm text-gray-500 mb-4">ID: {{ object.id }}</p>
          <p class="text-gray-600 max-w-2xl">{{ object.description|default:"Нет описания объекта" }}</p>
        </div>
      </div>
      
      <!-- Object Details Grid -->
      <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mt-6 pt-6 border-t border-gray-100">
        <div class="space-y-4">
          <div>
            <dt class="text-sm font-medium text-gray-500 mb-1">Организация</dt>
            <dd class="text-sm font-semibold text-gray-900 flex items-center gap-2">
              <svg class="w-4 h-4 text-gray-400" fill="currentColor" viewBox="0 0 20 20">
                <path d="M13 6a3 3 0 11-6 0 3 3 0 016 0zM18 8a2 2 0 11-4 0 2 2 0 014 0zM14 15a4 4 0 00-8 0v3h8v-3z"></path>
              </svg>
              {{ object.org.name }}
            </dd>
          </div>
        </div>
        <div class="space-y-4">
          <div>
            <dt class="text-sm font-medium text-gray-500 mb-1">Плановые сроки</dt>
            <dd class="text-sm text-gray-900 flex items-center gap-2">
              <svg class="w-4 h-4 text-gray-400" fill="currentColor" viewBox="0 0 20 20">
                <path fill-rule="evenodd" d="M6 2a1 1 0 00-1 1v1H4a2 2 0 00-2 2v10a2 2 0 002 2h12a2 2 0 002-2V6a2 2 0 00-2-2h-1V3a1 1 0 10-2 0v1H7V3a1 1 0 00-1-1zm0 5a1 1 0 000 2h8a1 1 0 100-2H6z" clip-rule="evenodd"></path>
              </svg>
              {{ object.plan_start|default:"—" }} до {{ object.plan_end|default:"—" }}
            </dd>
          </div>
        </div>
      </div>
    </div>
    
    <!-- FSM Actions -->
    {% if is_client or is_inspector or is_admin %}
    <div class="flex flex-col gap-3 lg:min-w-[200px]">
      <h3 class="text-sm font-semibold text-gray-700 flex items-center gap-2">
        <svg class="w-4 h-4" fill="currentColor" viewBox="0 0 20 20">
          <path fill-rule="evenodd" d="M11.3 1.046A1 1 0 0112 2v5h4a1 1 0 01.82 1.573l-7 10A1 1 0 018 18v-5H4a1 1 0 01-.82-1.573l7-10a1 1 0 011.12-.38z" clip-rule="evenodd"></path>
        </svg>
        Доступные действия
      </h3>
      <div class="space-y-2">
        {% if is_client and object.status != 'ACTIVE' %}
        <a href="{% url 'objects:edit' object.id %}" class="w-full inline-flex items-center justify-center gap-2 px-4 py-3 bg-gray-500 text-white rounded-xl hover:bg-gray-600 transition-all duration-200 font-medium group">
          <svg class="w-4 h-4 group-hover:scale-110 transition-transform" fill="currentColor" viewBox="0 0 20 20">
            <path d="M13.586 3.586a2 2 0 112.828 2.828l-.793.793-2.828-2.828.793-.793zM11.379 5.793L3 14.172V17h2.828l8.38-8.379-2.83-2.828z" />
          </svg>
          Редактировать
        </a>
        {% endif %}
        {% if object.status == 'DRAFT' %}
          {% if is_client %}
          <form method="post" action="{% url 'objects:plan' object.id %}" class="w-full">
            {% csrf_token %}
            <button type="submit" class="w-full inline-flex items-center justify-center gap-2 px-4 py-3 bg-blue-500 text-white rounded-xl hover:bg-blue-600 transition-all duration-200 font-medium group">
              <svg class="w-4 h-4 group-hover:scale-110 transition-transform" fill="currentColor" viewBox="0 0 20 20">
                <path fill-rule="evenodd" d="M6 2a1 1 0 00-1 1v1H4a2 2 0 00-2 2v10a2 2 0 002 2h12a2 2 0 002-2V6a2 2 0 00-2-2h-1V3a1 1 0 10-2 0v1H7V3a1 1 0 00-1-1zm0 5a1 1 0 000 2h8a1 1 0 100-2H6z" clip-rule="evenodd"></path>
              </svg>
              Планировать
            </button>
          </form>
          <form method="post" action="{% url 'objects:request_activation' object.id %}" class="w-full">
            {% csrf_token %}
            <button type="submit" class="w-full inline-flex items-center justify-center gap-2 px-4 py-3 bg-warning-500 text-white rounded-xl hover:bg-warning-600 transition-all duration-200 font-medium group">
              <svg class="w-4 h-4 group-hover:scale-110 transition-transform" fill="currentColor" viewBox="0 0 20 20">
                <path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z" clip-rule="evenodd"></path>
              </svg>
              Запрос активации
            </button>
          </form>
          {% endif %}
        {% elif object.status == 'PLANNED' %}
          {% if is_client %}
          <form method="post" action="{% url 'objects:request_activation' object.id %}" class="w-full">
            {% csrf_token %}
            <button type="submit" class="w-full inline-flex items-center justify-center gap-2 px-4 py-3 bg-warning-500 text-white rounded-xl hover:bg-warning-600 transition-all duration-200 font-medium group">
              <svg class="w-4 h-4 group-hover:scale-110 transition-transform" fill="currentColor" viewBox="0 0 20 20">
                <path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z" clip-rule="evenodd"></path>
              </svg>
              Запрос активации
            </button>
          </form>
          {% endif %}
          <form method="post" action="{% url 'objects:activate' object.id %}" class="w-full">
            {% csrf_token %}
            <button type="submit" class="w-full inline-flex items-center justify-center gap-2 px-4 py-3 bg-success-500 text-white rounded-xl hover:bg-success-600 transition-all duration-200 font-medium group">
              <svg class="w-4 h-4 group-hover:scale-110 transition-transform" fill="currentColor" viewBox="0 0 20 20">
                <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd"></path>
              </svg>
              Активировать
            </button>
          </form>
        {% elif object.status == 'ACTIVATION_PENDING' %}
          {% if is_inspector %}
          <form method="post" action="{% url 'objects:activate' object.id %}" class="w-full">
            {% csrf_token %}
            <button type="submit" class="w-full inline-flex items-center justify-center gap-2 px-4 py-3 bg-success-500 text-white rounded-xl hover:bg-success-600 transition-all duration-200 font-medium group">
              <svg class="w-4 h-4 group-hover:scale-110 transition-transform" fill="currentColor" viewBox="0 0 20 20">
                <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd"></path>
              </svg>
              Активировать
            </button>
          </form>
          {% endif %}
        {% elif object.status == 'ACTIVE' %}
          {% if is_admin or is_client %}
          <form method="post" action="{% url 'objects:close' object.id %}" class="w-full">
            {% csrf_token %}
            <button type="submit" class="w-full inline-flex items-center justify-center gap-2 px-4 py-3 bg-danger-500 text-white rounded-xl hover:bg-danger-600 transition-all duration-200 font-medium group">
              <svg class="w-4 h-4 group-hover:scale-110 transition-transform" fill="currentColor" viewBox="0 0 20 20">
                <path fill-rule="evenodd" d="M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z" clip-rule="evenodd"></path>
              </svg>
              Закрыть объект
            </button>
          </form>
          {% endif %}
        {% endif %}
      </div>
    </div>
    {% endif %}
  </div>
</div>

<!-- Enhanced Tabs -->
<div class="bg-white rounded-2xl shadow-sm border border-gray-100 overflow-hidden">
  <div class="border-b border-gray-100 bg-gradient-to-r from-gray-50 to-white">
    <nav class="flex overflow-x-auto" aria-label="Tabs">
      {% for tab_id, tab_name in tabs %}
        <a href="?tab={{ tab_id }}" class="group whitespace-nowrap px-6 py-4 text-sm font-medium transition-all duration-200 border-b-2 {% if active_tab == tab_id %}border-primary-500 text-primary-600 bg-primary-50/50{% else %}border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300 hover:bg-gray-50{% endif %}">
          <div class="flex items-center gap-2">
            {% if tab_id == 'info' %}
              <svg class="w-4 h-4" fill="currentColor" viewBox="0 0 20 20">
                <path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z" clip-rule="evenodd"></path>
              </svg>
            {% elif tab_id == 'deliveries' %}
              <svg class="w-4 h-4" fill="currentColor" viewBox="0 0 20 20">
                <path d="M8 16.5a1.5 1.5 0 11-3 0 1.5 1.5 0 013 0zM15 16.5a1.5 1.5 0 11-3 0 1.5 1.5 0 013 0z"></path>
                <path d="M3 4a1 1 0 00-1 1v10a1 1 0 001 1h1.05a2.5 2.5 0 014.9 0H10a1 1 0 001-1V5a1 1 0 00-1-1H3zM14 7a1 1 0 00-1 1v6.05A2.5 2.5 0 0115.95 16H17a1 1 0 001-1V8a1 1 0 00-1-1h-3z"></path>
              </svg>
            {% elif tab_id == 'remarks' %}
              <svg class="w-4 h-4" fill="currentColor" viewBox="0 0 20 20">
                <path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z" clip-rule="evenodd"></path>
              </svg>
            {% elif tab_id == 'checklist' %}
              <svg class="w-4 h-4" fill="currentColor" viewBox="0 0 20 20">
                <path fill-rule="evenodd" d="M3 4a1 1 0 011-1h12a1 1 0 011 1v2a1 1 0 01-1 1H4a1 1 0 01-1-1V4zm0 4a1 1 0 011-1h12a1 1 0 011 1v2a1 1 0 01-1 1H4a1 1 0 01-1-1V8zm0 4a1 1 0 011-1h12a1 1 0 011 1v2a1 1 0 01-1 1H4a1 1 0 01-1-1v-2z" clip-rule="evenodd"></path>
              </svg>
            {% elif tab_id == 'daily_checklists' %}
              <svg class="w-4 h-4" fill="currentColor" viewBox="0 0 20 20">
                <path fill-rule="evenodd" d="M6 2a1 1 0 00-1 1v1H4a2 2 0 00-2 2v10a2 2 0 002 2h12a2 2 0 002-2V6a2 2 0 00-2-2h-1V3a1 1 0 10-2 0v1H7V3a1 1 0 00-1-1zm0 5a1 1 0 000 2h8a1 1 0 100-2H6z" clip-rule="evenodd"></path>
              </svg>
            {% endif %}
            {{ tab_name }}
          </div>
        </a>
      {% endfor %}
    </nav>
  </div>

  <!-- Tab Content -->
  <div class="p-6">
    {% if active_tab == 'info' %}
      <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
        <div class="space-y-6">
          <div class="bg-gray-50 rounded-xl p-6">
            <h3 class="text-lg font-semibold text-gray-900 mb-4 flex items-center gap-2">
              <svg class="w-5 h-5 text-gray-600" fill="currentColor" viewBox="0 0 20 20">
                <path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z" clip-rule="evenodd"></path>
              </svg>
              Основная информация
            </h3>
            <dl class="space-y-4">
              <div>
                <dt class="text-sm font-medium text-gray-500">Организация</dt>
                <dd class="mt-1 text-sm font-semibold text-gray-900">{{ object.org.name }}</dd>
              </div>
              <div>
                <dt class="text-sm font-medium text-gray-500">Статус проекта</dt>
                <dd class="mt-1">{% status_badge object.status %}</dd>
              </div>
            </dl>
          </div>
        </div>
        
        <div class="space-y-6">
          <div class="bg-gray-50 rounded-xl p-6">
            <h3 class="text-lg font-semibold text-gray-900 mb-4 flex items-center gap-2">
              <svg class="w-5 h-5 text-gray-600" fill="currentColor" viewBox="0 0 20 20">
                <path fill-rule="evenodd" d="M6 2a1 1 0 00-1 1v1H4a2 2 0 00-2 2v10a2 2 0 002 2h12a2 2 0 002-2V6a2 2 0 00-2-2h-1V3a1 1 0 10-2 0v1H7V3a1 1 0 00-1-1zm0 5a1 1 0 000 2h8a1 1 0 100-2H6z" clip-rule="evenodd"></path>
              </svg>
              Временные рамки
            </h3>
            <dl class="space-y-4">
              <div>
                <dt class="text-sm font-medium text-gray-500">Плановое начало</dt>
                <dd class="mt-1 text-sm text-gray-900">{{ object.plan_start|default:"Не указано" }}</dd>
              </div>
              <div>
                <dt class="text-sm font-medium text-gray-500">Плановое окончание</dt>
                <dd class="mt-1 text-sm text-gray-900">{{ object.plan_end|default:"Не указано" }}</dd>
              </div>
            </dl>
          </div>
        </div>
      </div>
      
    {% elif active_tab == 'deliveries' %}
      <div class="flex items-center justify-between mb-6">
        <h2 class="text-xl font-semibold text-gray-900 flex items-center gap-3">
          <svg class="w-6 h-6 text-gray-600" fill="currentColor" viewBox="0 0 20 20">
            <path d="M8 16.5a1.5 1.5 0 11-3 0 1.5 1.5 0 013 0zM15 16.5a1.5 1.5 0 11-3 0 1.5 1.5 0 013 0z"></path>
            <path d="M3 4a1 1 0 00-1 1v10a1 1 0 001 1h1.05a2.5 2.5 0 014.9 0H10a1 1 0 001-1V5a1 1 0 00-1-1H3zM14 7a1 1 0 00-1 1v6.05A2.5 2.5 0 0115.95 16H17a1 1 0 001-1V8a1 1 0 00-1-1h-3z"></path>
          </svg>
          Поставки материалов
        </h2>
        <a href="{% url 'objects:delivery_new' object.id %}" class="inline-flex items-center gap-2 px-4 py-2 bg-primary-500 text-white rounded-xl hover:bg-primary-600 transition-all duration-200 font-medium group">
          <svg class="w-4 h-4 group-hover:scale-110 transition-transform" fill="currentColor" viewBox="0 0 20 20">
            <path fill-rule="evenodd" d="M10 5a1 1 0 011 1v3h3a1 1 0 110 2h-3v3a1 1 0 11-2 0v-3H6a1 1 0 110-2h3V6a1 1 0 011-1z" clip-rule="evenodd"></path>
          </svg>
          Добавить поставку
        </a>
      </div>
      
      <div class="overflow-hidden rounded-xl border border-gray-200">
        <div class="hidden lg:block">
          <table class="min-w-full divide-y divide-gray-200">
            <thead class="bg-gray-50">
              <tr>
                <th class="px-6 py-4 text-left text-xs font-semibold text-gray-600 uppercase tracking-wider">Материал</th>
                <th class="px-6 py-4 text-left text-xs font-semibold text-gray-600 uppercase tracking-wider">Количество</th>
                <th class="px-6 py-4 text-left text-xs font-semibold text-gray-600 uppercase tracking-wider">Дата поставки</th>
                <th class="px-6 py-4 text-left text-xs font-semibold text-gray-600 uppercase tracking-wider">Статус</th>
              </tr>
            </thead>
            <tbody class="divide-y divide-gray-200 bg-white">
              {% for d in deliveries %}
                <tr class="hover:bg-gray-50 transition-colors duration-200">
                  <td class="px-6 py-4">
                    <div class="text-sm font-medium text-gray-900">{{ d.material.name }}</div>
                    <div class="text-xs text-gray-500">{{ d.material.category|default:"Материал" }}</div>
                  </td>
                  <td class="px-6 py-4 text-sm text-gray-900">{{ d.quantity }} {{ d.material.unit }}</td>
                  <td class="px-6 py-4 text-sm text-gray-900">{{ d.delivered_at|date:'d.m.Y H:i' }}</td>
                  <td class="px-6 py-4">
                    <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-success-100 text-success-800">
                      Доставлено
                    </span>
                  </td>
                </tr>
              {% empty %}
                <tr>
                  <td colspan="4" class="px-6 py-12 text-center">
                    <div class="flex flex-col items-center space-y-3">
                      <svg class="w-12 h-12 text-gray-300" fill="currentColor" viewBox="0 0 20 20">
                        <path d="M8 16.5a1.5 1.5 0 11-3 0 1.5 1.5 0 013 0zM15 16.5a1.5 1.5 0 11-3 0 1.5 1.5 0 013 0z"></path>
                        <path d="M3 4a1 1 0 00-1 1v10a1 1 0 001 1h1.05a2.5 2.5 0 014.9 0H10a1 1 0 001-1V5a1 1 0 00-1-1H3zM14 7a1 1 0 00-1 1v6.05A2.5 2.5 0 0115.95 16H17a1 1 0 001-1V8a1 1 0 00-1-1h-3z"></path>
                      </svg>
                      <p class="text-sm font-medium text-gray-900">Поставок пока нет</p>
                      <p class="text-xs text-gray-500">Добавьте первую поставку материалов</p>
                    </div>
                  </td>
                </tr>
              {% endfor %}
            </tbody>
          </table>
        </div>
        
        <!-- Mobile Cards -->
        <div class="lg:hidden divide-y divide-gray-200">
          {% for d in deliveries %}
            <div class="p-4">
              <div class="flex items-start justify-between">
                <div class="flex-1">
                  <h4 class="text-sm font-medium text-gray-900">{{ d.material.name }}</h4>
                  <p class="text-xs text-gray-500 mt-1">{{ d.quantity }} {{ d.material.unit }}</p>
                  <p class="text-xs text-gray-500 mt-1">{{ d.delivered_at|date:'d.m.Y H:i' }}</p>
                </div>
                <span class="inline-flex items-center px-2 py-1 rounded-full text-xs font-medium bg-success-100 text-success-800">
                  Доставлено
                </span>
              </div>
            </div>
          {% empty %}
            <div class="p-8 text-center">
              <p class="text-sm text-gray-500">Поставок пока нет</p>
            </div>
          {% endfor %}
        </div>
      </div>
      
    {% elif active_tab == 'remarks' %}
      <div class="flex items-center justify-between mb-6">
        <h2 class="text-xl font-semibold text-gray-900 flex items-center gap-3">
          <svg class="w-6 h-6 text-gray-600" fill="currentColor" viewBox="0 0 20 20">
            <path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z" clip-rule="evenodd"></path>
          </svg>
          Нарушения
        </h2>
        <a href="{% url 'objects:remark_new' object.id %}" class="inline-flex items-center gap-2 px-4 py-2 bg-danger-500 text-white rounded-xl hover:bg-danger-600 transition-all duration-200 font-medium group">
          <svg class="w-4 h-4 group-hover:scale-110 transition-transform" fill="currentColor" viewBox="0 0 20 20">
            <path fill-rule="evenodd" d="M10 5a1 1 0 011 1v3h3a1 1 0 110 2h-3v3a1 1 0 11-2 0v-3H6a1 1 0 110-2h3V6a1 1 0 011-1z" clip-rule="evenodd"></path>
          </svg>
          Добавить нарушение
        </a>
      </div>
      
      <div class="overflow-hidden rounded-xl border border-gray-200">
        <div class="hidden lg:block">
          <table class="min-w-full divide-y divide-gray-200">
            <thead class="bg-gray-50">
              <tr>
                <th class="px-6 py-4 text-left text-xs font-semibold text-gray-600 uppercase tracking-wider">Категория</th>
                <th class="px-6 py-4 text-left text-xs font-semibold text-gray-600 uppercase tracking-wider">Вид</th>
                <th class="px-6 py-4 text-left text-xs font-semibold text-gray-600 uppercase tracking-wider">Тип</th>
                <th class="px-6 py-4 text-left text-xs font-semibold text-gray-600 uppercase tracking-wider">Срок</th>
                <th class="px-6 py-4 text-left text-xs font-semibold text-gray-600 uppercase tracking-wider">Статус</th>
                <th class="px-6 py-4 text-left text-xs font-semibold text-gray-600 uppercase tracking-wider">Создано</th>
                <th class="px-6 py-4 text-left text-xs font-semibold text-gray-600 uppercase tracking-wider">Приоритет</th>
              </tr>
            </thead>
            <tbody class="divide-y divide-gray-200 bg-white">
              {% for r in remarks %}
                <tr class="hover:bg-gray-50 transition-colors duration-200">
                  <td class="px-6 py-4">
                    <div class="text-sm font-medium text-gray-900">
                      <a href="{% url 'issues:remark_detail' r.id %}" class="text-primary-600 hover:text-primary-800">{{ r.category }}</a>
                    </div>
                    <div class="text-xs text-gray-500">{{ r.description|truncatechars:50 }}</div>
                  </td>
                  <td class="px-6 py-4 text-sm text-gray-900">{{ r.get_fixability_display }}</td>
                  <td class="px-6 py-4 text-sm text-gray-900">{{ r.get_issue_type_display }}</td>
                  <td class="px-6 py-4 text-sm text-gray-900">{{ r.resolution_deadline_days|default:"-" }}</td>
                  <td class="px-6 py-4">
                    <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-warning-100 text-warning-800">
                      {{ r.get_status_display }}
                    </span>
                  </td>
                  <td class="px-6 py-4 text-sm text-gray-900">{{ r.created_at|date:'d.m.Y H:i' }}</td>
                  <td class="px-6 py-4">
                    <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-danger-100 text-danger-800">
                      Высокий
                    </span>
                  </td>
                </tr>
              {% empty %}
                <tr>
                  <td colspan="7" class="px-6 py-12 text-center">
                    <div class="flex flex-col items-center space-y-3">
                      <svg class="w-12 h-12 text-gray-300" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd"></path>
                      </svg>
                      <p class="text-sm font-medium text-gray-900">Нарушений пока нет</p>
                      <p class="text-xs text-gray-500">Это хорошо! Объект соответствует требованиям</p>
                    </div>
                  </td>
                </tr>
              {% endfor %}
            </tbody>
          </table>
        </div>
        
        <!-- Mobile Cards -->
        <div class="lg:hidden divide-y divide-gray-200">
          {% for r in remarks %}
            {% url 'issues:remark_detail' r.id as remark_url %}
            <div class="p-4 hover:bg-gray-50 cursor-pointer" onclick="window.location.href='{{ remark_url }}'">
              <div class="flex items-start justify-between">
                <div class="flex-1">
                  <h4 class="text-sm font-medium text-gray-900">{{ r.category.title }}</h4>
                  <p class="text-xs text-gray-500 mt-1">{{ r.created_at|date:'d.m.Y H:i' }}</p>
                </div>
                <span class="inline-flex items-center px-2 py-1 rounded-full text-xs font-medium bg-warning-100 text-warning-800">
                  {{ r.get_status_display }}
                </span>
              </div>
            </div>
          {% empty %}
            <div class="p-8 text-center">
              <p class="text-sm text-gray-500">Нарушений пока нет</p>
            </div>
          {% endfor %}
        </div>
      </div>
      
    {% elif active_tab == 'checklist' %}
      <div class="space-y-6">
        <h2 class="text-xl font-semibold text-gray-900 flex items-center gap-3">
          <svg class="w-6 h-6 text-gray-600" fill="currentColor" viewBox="0 0 20 20">
            <path fill-rule="evenodd" d="M3 4a1 1 0 011-1h12a1 1 0 011 1v2a1 1 0 01-1 1H4a1 1 0 01-1-1V4zm0 4a1 1 0 011-1h12a1 1 0 011 1v2a1 1 0 01-1 1H4a1 1 0 01-1-1V8zm0 4a1 1 0 011-1h12a1 1 0 011 1v2a1 1 0 01-1 1H4a1 1 0 01-1-1v-2z" clip-rule="evenodd"></path>
          </svg>
          Чек-лист активации объекта
        </h2>
        
        {% if checklist %}
          <div class="bg-gray-50 rounded-xl p-6">
            <div class="flex items-center justify-between mb-4">
              <div class="flex items-center gap-3">
                <h3 class="text-lg font-semibold text-gray-900">Статус чек-листа</h3>
                <span class="inline-flex items-center px-3 py-1 rounded-full text-sm font-medium {% if checklist.status == 'APPROVED' %}bg-success-100 text-success-800{% elif checklist.status == 'REJECTED' %}bg-danger-100 text-danger-800{% else %}bg-warning-100 text-warning-800{% endif %}">
                  {{ checklist.get_status_display }}
                </span>
              </div>
              <div class="flex flex-wrap gap-2">
                {% if can_change_checklist %}
                  <a href="{% url 'objects:checklist_edit' object.id %}" class="inline-flex items-center gap-2 px-4 py-2 bg-blue-500 text-white rounded-lg hover:bg-blue-600 transition-all duration-200 text-sm font-medium">
                    <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15.232 5.232l3.536 3.536M4 20h4l10.607-10.607a1 1 0 000-1.414l-3.586-3.586a1 1 0 00-1.414 0L4 14v4z"/></svg>
                    Редактировать
                  </a>
                {% endif %}
                {% if can_delete_checklist %}
                  <form method="post" action="{% url 'objects:checklist_delete' object.id %}" onsubmit="return confirm('Удалить чек-лист?')" class="inline">
                    {% csrf_token %}
                    <button type="submit" class="inline-flex items-center gap-2 px-4 py-2 bg-danger-500 text-white rounded-lg hover:bg-danger-600 transition-all duration-200 text-sm font-medium">
                      <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"/></svg>
                      Удалить
                    </button>
                  </form>
                {% endif %}
              </div>
            </div>
            
            {% if checklist.review_comment %}
              <div class="mt-4 p-4 bg-white rounded-lg border border-gray-200">
                <h4 class="text-sm font-semibold text-gray-900 mb-2">Комментарий рецензента</h4>
                <p class="text-sm text-gray-700">{{ checklist.review_comment }}</p>
              </div>
            {% endif %}
            
            <div class="mt-6">
              <h4 class="text-sm font-semibold text-gray-900 mb-3">Данные чек-листа</h4>
              <div class="bg-white rounded-lg border border-gray-200 p-4 overflow-auto max-h-64">
                <pre class="text-xs text-gray-700 whitespace-pre-wrap">{{ checklist.data|json_script:"cl_data" }}</pre>
              </div>
            </div>
          </div>
        {% else %}
          <div class="text-center py-12">
            <svg class="w-16 h-16 text-gray-300 mx-auto mb-4" fill="currentColor" viewBox="0 0 20 20">
              <path fill-rule="evenodd" d="M3 4a1 1 0 011-1h12a1 1 0 011 1v2a1 1 0 01-1 1H4a1 1 0 01-1-1V4zm0 4a1 1 0 011-1h12a1 1 0 011 1v2a1 1 0 01-1 1H4a1 1 0 01-1-1V8zm0 4a1 1 0 011-1h12a1 1 0 011 1v2a1 1 0 01-1 1H4a1 1 0 01-1-1v-2z" clip-rule="evenodd"></path>
            </svg>
            <h3 class="text-lg font-medium text-gray-900 mb-2">Чек-лист не создан</h3>
            {% if can_create_checklist %}
              <a href="{% url 'objects:checklist_create' object.id %}" class="inline-flex items-center gap-2 px-4 py-2 bg-primary-600 text-white rounded-lg hover:bg-primary-700 transition-colors text-sm font-medium">
                <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4"/></svg>
                Создать чек-лист
              </a>
            {% else %}
              <p class="text-sm text-gray-500">Нет прав на создание чек-листа</p>
            {% endif %}
          </div>
        {% endif %}
      </div>
    {% elif active_tab == 'daily_checklists' %}
      <div class="space-y-6">
        <!-- Daily Checklists List -->
        {% if daily_checklists %}
          <div class="space-y-4">
            {% for dc in daily_checklists %}
              <div class="bg-white border border-gray-200 rounded-xl p-6 shadow-sm">
                <div class="flex items-start justify-between mb-4">
                  <div class="flex-1">
                    <div class="flex items-center gap-3 mb-2">
                      <h3 class="text-lg font-semibold text-gray-900">Ежедневный чек-лист от {{ dc.created_at|date:"d.m.Y" }}</h3>
                      <span class="inline-flex items-center px-3 py-1 rounded-full text-sm font-medium {% if dc.status == 'APPROVED' %}bg-success-100 text-success-800{% elif dc.status == 'PENDING_CONFIRMATION' %}bg-warning-100 text-warning-800{% else %}bg-gray-100 text-gray-800{% endif %}">
                        {{ dc.get_status_display }}
                      </span>
                    </div>
                    <p class="text-sm text-gray-600">Создан: {{ dc.created_at|date:"d.m.Y H:i" }} пользователем {{ dc.created_by.get_full_name|default:dc.created_by.username }}</p>
                    {% if dc.confirmed_at %}
                      <p class="text-sm text-gray-600">Подтвержден: {{ dc.confirmed_at|date:"d.m.Y H:i" }} пользователем {{ dc.confirmed_by.get_full_name|default:dc.confirmed_by.username }}</p>
                    {% endif %}
                  </div>
                  <div class="flex items-center gap-2">
                    {% if can_change_daily_checklist and dc.status == 'DRAFT' and dc.created_by == user %}
                      <a href="{% url 'objects:daily_checklist_edit' dc.id %}" class="inline-flex items-center gap-2 px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors text-sm font-medium">
                        <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"/>
                        </svg>
                        Редактировать
                      </a>
                      <form method="post" action="{% url 'objects:daily_checklist_submit' dc.id %}" class="inline">
                        {% csrf_token %}
                        <button type="submit" class="inline-flex items-center gap-2 px-4 py-2 bg-orange-600 text-white rounded-lg hover:bg-orange-700 transition-colors text-sm font-medium">
                          <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 19l9 2-9-18-9 18 9-2zm0 0v-8"/>
                          </svg>
                          Отправить на подтверждение
                        </button>
                      </form>
                    {% endif %}
                    {% if can_confirm_daily_checklist and dc.status == 'PENDING_CONFIRMATION' %}
                      <form method="post" action="{% url 'objects:daily_checklist_confirm' dc.id %}" class="inline">
                        {% csrf_token %}
                        <button type="submit" class="inline-flex items-center gap-2 px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 transition-colors text-sm font-medium">
                          <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"/></svg>
                          Подтвердить
                        </button>
                      </form>
                    {% endif %}
                  </div>
                </div>
                <div class="border-t border-gray-100 pt-4">
                  <pre class="text-xs text-gray-700 whitespace-pre-wrap">{{ dc.data|json_script:"dc_data" }}</pre>
                </div>
              </div>
            {% endfor %}
          </div>
        {% else %}
          <div class="text-center py-12">
            <svg class="w-16 h-16 text-gray-300 mx-auto mb-4" fill="currentColor" viewBox="0 0 20 20">
              <path fill-rule="evenodd" d="M6 2a1 1 0 00-1 1v1H4a2 2 0 00-2 2v10a2 2 0 002 2h12a2 2 0 002-2V6a2 2 0 00-2-2h-1V3a1 1 0 10-2 0v1H7V3a1 1 0 00-1-1zm0 5a1 1 0 000 2h8a1 1 0 100-2H6z" clip-rule="evenodd"></path>
            </svg>
            <h3 class="text-lg font-medium text-gray-900 mb-2">Ежедневные чек-листы отсутствуют</h3>
            {% if can_create_daily_checklist %}
              <form method="post" action="{% url 'objects:daily_checklist_create' object.id %}">
                {% csrf_token %}
                <button type="submit" class="inline-flex items-center gap-2 px-4 py-2 bg-primary-600 text-white rounded-lg hover:bg-primary-700 transition-colors text-sm font-medium">
                  <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4"/></svg>
                  Создать ежедневный чек-лист
                </button>
              </form>
            {% else %}
              <p class="text-sm text-gray-500">Нет прав на создание ежедневного чек-листа</p>
            {% endif %}
          </div>
        {% endif %}

        <!-- Create Button at Bottom if there are checklists -->
        {% if daily_checklists and can_create_daily_checklist %}
          <div class="flex justify-center pt-6 border-t border-gray-100">
            <form method="post" action="{% url 'objects:daily_checklist_create' object.id %}">
              {% csrf_token %}
              <button type="submit" class="inline-flex items-center gap-2 px-6 py-3 bg-primary-600 text-white rounded-lg hover:bg-primary-700 transition-colors text-sm font-medium">
                <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4"/></svg>
                Создать ежедневный чек-лист
              </button>
            </form>
          </div>
        {% endif %}
      </div>
    {% endif %}
  </div>
</div>
{% endblock %}
