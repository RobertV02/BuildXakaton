{% extends 'base.html' %}
{% block title %}Просмотр ежедневного чек-листа - {{ object.name }}{% endblock %}
{% block page_heading %}{{ object.name }}{% endblock %}
{% block page_subtitle %}Просмотр ежедневного чек-листа{% endblock %}
{% block content %}
<div class="max-w-7xl mx-auto">
  <div class="mb-6 flex items-center gap-3 text-sm text-gray-500">
    <a href="{% url 'objects:detail' object.id %}?tab=daily_checklists" class="hover:text-primary-600">← Назад к объекту</a>
  </div>
  <div class="bg-white rounded-2xl shadow-sm border border-gray-100 p-6">
    <div class="mb-6">
      <h1 class="text-2xl font-bold text-gray-900 mb-2">ЧЕК-ЛИСТ (ФОРМА №2 - ЕЖЕДНЕВНЫЙ) проверки качества выполнения комплекса строительно-монтажных работ</h1>
      <p class="text-lg text-gray-700">ФОРМА №2 «Благоустройство территорий»</p>
    </div>

    <div class="mb-4 p-4 bg-blue-50 rounded-lg">
      <p class="text-sm text-blue-700">
        <strong>Статус:</strong> {{ checklist.get_status_display }}
      </p>
      <p class="text-sm text-blue-700">
        <strong>Создан:</strong> {{ checklist.created_at|date:"d.m.Y H:i" }}
      </p>
      <p class="text-sm text-blue-700">
        <strong>Отправлен на подтверждение:</strong> {{ checklist.submitted_at|date:"d.m.Y H:i" }}
      </p>
      <p class="text-sm text-blue-700">
        <strong>Объект:</strong> {{ object.name }}
      </p>
      <p class="text-sm text-blue-700">
        <strong>Подрядчик:</strong> {{ object.org.name }}
      </p>
      <p class="text-sm text-blue-700">
        <strong>Дата проверки:</strong> {{ checklist.created_at|date:"d.m.Y" }}
      </p>
    </div>

    <div class="overflow-x-auto">
      <table class="min-w-full divide-y divide-gray-200">
        <thead class="bg-gray-50">
          <tr>
            <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
              № п/п
            </th>
            <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
              Проверяемый аспект (нормативный документ)
            </th>
            <th scope="col" class="px-6 py-3 text-center text-xs font-medium text-gray-500 uppercase tracking-wider">
              Статус
            </th>
          </tr>
        </thead>
        <tbody class="bg-white divide-y divide-gray-200">
          {% load object_extras %}
          {% for item in checklist_items %}
          <tr class="{% if item.section %}bg-gray-100 font-semibold{% endif %}">
            <td class="px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900">
              {{ item.id }}
            </td>
            <td class="px-6 py-4 text-sm text-gray-900">
              {% if item.section %}
                <strong>{{ item.section }}</strong><br>
              {% endif %}
              {{ item.text }}
              {% if item.normative_doc %}
                <br><em class="text-gray-600">{{ item.normative_doc }}</em>
              {% endif %}
            </td>
            <td class="px-6 py-4 whitespace-nowrap text-center">
              {% with status=checklist.data|get_item:item.id %}
                {% if status == 'yes' %}
                  <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-green-100 text-green-800">
                    ДА
                  </span>
                {% elif status == 'no' %}
                  <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-red-100 text-red-800">
                    НЕТ
                  </span>
                {% elif status == 'not_required' %}
                  <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-gray-100 text-gray-800">
                    Не требуется
                  </span>
                {% else %}
                  <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-yellow-100 text-yellow-800">
                    Не проверено
                  </span>
                {% endif %}
              {% endwith %}
            </td>
          </tr>
          {% endfor %}
        </tbody>
      </table>
    </div>

    <div class="mt-6 p-4 bg-yellow-50 rounded-lg">
      <h3 class="text-sm font-medium text-yellow-800 mb-2">Подтверждение чек-листа</h3>
      <p class="text-sm text-yellow-700 mb-4">
        Пожалуйста, внимательно ознакомьтесь с результатами проверки. После подтверждения чек-лист будет считаться принятым.
      </p>
      <form method="post" action="{% url 'objects:daily_checklist_confirm' checklist.id %}" class="inline">
        {% csrf_token %}
        <button type="submit" class="inline-flex items-center gap-2 px-6 py-3 rounded-lg bg-green-600 hover:bg-green-700 text-white font-medium transition-colors">
          <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7" />
          </svg>
          Подтвердить чек-лист
        </button>
      </form>
    </div>

    <div class="flex items-center justify-end gap-3 pt-4 border-t border-gray-100 mt-6">
      <a href="{% url 'objects:detail' object.id %}?tab=daily_checklists" class="px-4 py-2 text-sm font-medium text-gray-600 hover:text-gray-800">Отмена</a>
    </div>
  </div>
</div>
{% endblock %}